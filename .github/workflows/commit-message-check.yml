name: Commit Message Format Check

on:
  pull_request:
    branches:
      - main

jobs:
  validate-commit-messages:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Validate commit messages
        run: |
          echo "‚è≥ Commit messages are being checked..."
          INVALID_FOUND=0
          COMMITS=$(git log origin/${{ github.base_ref }}..HEAD --pretty=format:"%s")
          echo "$COMMITS" | while read COMMIT_MSG; do
            echo "üîç $COMMIT_MSG"
            echo "$COMMIT_MSG" | grep -Eq "^(feat|fix|chore|docs|style|refactor|test)(\(.+\))?: .{1,}" || {
              echo "‚ùå Incorrect commit message:"
              echo "$COMMIT_MSG"
              INVALID_FOUND=1
            }
          done
          if [ $INVALID_FOUND -eq 1 ]; then
            echo "üö´ Commit message validation failed."
            exit 1
          else
            echo "‚úÖ All commit messages are valid."
          fi
